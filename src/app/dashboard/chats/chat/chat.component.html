<section
  click-stop-propagation
  (click)="chatOverlay.profileOverlay = false"
  class="darker-screen"
  [ngClass]="{ 'no-display': !chatOverlay.profileOverlay }"
>
  <div
    [ngClass]="{ 'no-display': !chatOverlay.profileOverlay }"
    click-stop-propagation
    class="toggle-item"
  >
    <div>
      <h2>Profil</h2>

      <button (click)="chatOverlay.closeProfile()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_153677_6137"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="24"
            height="24"
          >
            <rect width="24" height="24" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_153677_6137)">
            <path
              d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
              fill="black"
            />
          </g>
        </svg>
      </button>
    </div>
    <img [src]="chatController.getLargeAvatar(chatOverlay.clickedUser?.avatar)" alt="" />

    <div class="profile-name">
      <h3>{{ chatOverlay.clickedUser?.name ?? "Anon" }}</h3>
    </div>

    <div class="profile-status">
      <img src="../../../../assets/img/active.svg" alt="" />
      <h3>Aktiv</h3>
    </div>

    <div class="profile-email">
      <div>
        <img src="../../../../assets/img/mail.svg" alt="" />
        <h3>E-Mail-Adresse</h3>
      </div>
      <a href="">{{ chatOverlay.clickedUser?.email ?? "emre.iscan&#64;outlook.de" }} </a>
    </div>

    <div
      (click)="emitPartner(chatOverlay.clickedUser?.uid); chatOverlay.closeProfile()"
      class="profile-direct-message"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_157535_8230"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_157535_8230)">
          <path
            d="M20.3 20.3L18 18H4C3.45 18 2.97933 17.8043 2.588 17.413C2.196 17.021 2 16.55 2 16V4C2 3.45 2.196 2.979 2.588 2.587C2.97933 2.19567 3.45 2 4 2H20C20.55 2 21.021 2.19567 21.413 2.587C21.8043 2.979 22 3.45 22 4V19.575C22 20.025 21.796 20.3373 21.388 20.512C20.9793 20.6873 20.6167 20.6167 20.3 20.3ZM4 4V16H18.825L20 17.175V4H4Z"
            fill="white"
          />
        </g>
      </svg>

      <h3>Nachricht</h3>
    </div>
  </div>
</section>

<section
  (click)="
    chatOverlay.overlayActivated = false;
    chatOverlay.channelOverlay = false;
    chatOverlay.viewMemberOverlay = false;
    chatOverlay.addMemberOverlay = false;
    chatOverlay.profileOverlay = false
  "
  class="overlay"
  [ngClass]="{ 'no-display': !chatOverlay.overlayActivated }"
></section>

<header>
  <h2
    (click)="chatOverlay.overlayFunction(true, 'Entwicklung', true)"
    [ngClass]="{ 'edit-channel-active': chatOverlay.channelOverlay }"
  >
    <div>
      <svg
        width="22"
        height="23"
        viewBox="0 0 22 23"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M4.65649 23C4.23359 23 3.88859 22.8203 3.6215 22.4609C3.3544 22.1016 3.2765 21.7062 3.38779 21.275L4.32262 17.25H1.35119C0.906029 17.25 0.549902 17.0646 0.282807 16.6937C0.0157114 16.3219 -0.0621913 15.9083 0.0490984 15.4531C0.115872 15.1177 0.271678 14.8542 0.516515 14.6625C0.761352 14.4708 1.03958 14.375 1.35119 14.375H4.99036L6.32583 8.625H2.68666C2.2415 8.625 1.88538 8.43956 1.61828 8.06869C1.35119 7.69685 1.27328 7.28333 1.38457 6.82812C1.45135 6.49271 1.60715 6.22917 1.85199 6.0375C2.09683 5.84583 2.37505 5.75 2.68666 5.75H6.99357L8.09534 1.04219C8.16211 0.730729 8.30679 0.479166 8.52937 0.2875C8.75195 0.095833 9.01904 0 9.33066 0C9.75356 0 10.0986 0.179688 10.3656 0.539062C10.6327 0.898438 10.7106 1.29375 10.5994 1.725L9.66452 5.75H15.0064L16.1082 1.04219C16.175 0.730729 16.3196 0.479166 16.5422 0.2875C16.7648 0.095833 17.0319 0 17.3435 0C17.7664 0 18.1114 0.179688 18.3785 0.539062C18.6456 0.898438 18.7235 1.29375 18.6122 1.725L17.6774 5.75H20.6488C21.094 5.75 21.4501 5.93544 21.7172 6.30631C21.9843 6.67815 22.0622 7.09167 21.9509 7.54688C21.8841 7.88229 21.7283 8.14583 21.4835 8.3375C21.2386 8.52917 20.9604 8.625 20.6488 8.625H17.0096L15.6742 14.375H19.3133C19.7585 14.375 20.1146 14.5604 20.3817 14.9313C20.6488 15.3031 20.7267 15.7167 20.6154 16.1719C20.5487 16.5073 20.3928 16.7708 20.148 16.9625C19.9032 17.1542 19.6249 17.25 19.3133 17.25H15.0064L13.9047 21.9578C13.8379 22.2693 13.6932 22.5208 13.4706 22.7125C13.2481 22.9042 12.981 23 12.6693 23C12.2464 23 11.9014 22.8203 11.6344 22.4609C11.3673 22.1016 11.2894 21.7062 11.4006 21.275L12.3355 17.25H6.99357L5.89181 21.9578C5.82503 22.2693 5.68035 22.5208 5.45778 22.7125C5.2352 22.9042 4.9681 23 4.65649 23ZM7.66131 14.375H13.0032L14.3387 8.625H8.99679L7.66131 14.375Z"
          fill="black"
        />
      </svg>
      {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
      <svg
        width="14"
        height="9"
        viewBox="0 0 14 9"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M7 8.59375C6.83259 8.59375 6.67061 8.5625 6.51408 8.5C6.35671 8.4375 6.22571 8.35417 6.12108 8.25L0.345291 2.5C0.115097 2.27083 0 1.97917 0 1.625C0 1.27083 0.115097 0.979166 0.345291 0.75C0.575485 0.520833 0.86846 0.40625 1.22422 0.40625C1.57997 0.40625 1.87294 0.520833 2.10314 0.75L7 5.625L11.8969 0.75C12.1271 0.520833 12.42 0.40625 12.7758 0.40625C13.1315 0.40625 13.4245 0.520833 13.6547 0.75C13.8849 0.979166 14 1.27083 14 1.625C14 1.97917 13.8849 2.27083 13.6547 2.5L7.87892 8.25C7.75336 8.375 7.61734 8.46333 7.47085 8.515C7.32436 8.5675 7.16741 8.59375 7 8.59375Z"
          fill="black"
        />
      </svg>
    </div>

    <div
      #channelEdit
      class="channel-infos no-scrollbar"
      [ngClass]="{ 'no-display': !this.chatOverlay.channelOverlay }"
    >
      <div>
        <h3>
          # {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
        </h3>
        <div>
          <svg
            click-stop-propagation
            (click)="chatOverlay.overlayFunction(false, 'Entwicklung', false)"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <mask
              id="mask0_153677_6137"
              style="mask-type: alpha"
              maskUnits="userSpaceOnUse"
              x="0"
              y="0"
              width="24"
              height="24"
            >
              <rect width="24" height="24" fill="#D9D9D9" />
            </mask>
            <g mask="url(#mask0_153677_6137)">
              <path
                d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                fill="black"
              />
            </g>
          </svg>
        </div>
      </div>
      <div [ngClass]="{ 'edit-one': editChannelName }">
        <div>
          <h3>Channel-Name</h3>
          <img
            (click)="channelNameError === null && saveEditedName()"
            class="edit-channel-mobile"
            [class.disabled]="channelNameError !== null && editChannelName"
            [src]="
              editChannelName
                ? '/assets/icons/svgs/edit.svg'
                : '/assets/icons/svgs/edit-pencil.svg'
            "
            alt=""
          />
          <h3
            class="edit-channel"
            [class.disabled]="channelNameError !== null && editChannelName"
            (click)="channelNameError === null && saveEditedName()"
            *ngIf="currentChat !== 'DALobby' && userInChannel"
          >
            @if (editChannelName) { Speichern } @else { Bearbeiten }
          </h3>
        </div>
        @if (editChannelName) {
        <div>
          <h2>#</h2>
          <input
            [(ngModel)]="channelName"
            (input)="channelNameError = null"
            type="text"
            placeholder="{{
              currentChat.charAt(0).toUpperCase() + currentChat.slice(1)
            }}"
          />
        </div>
        } @else {
        <h3>
          # {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
        </h3>
        }
      </div>
      <div
        [ngClass]="{ 'channel-description': editDescription }"
        class="channel-description"
      >
        <div>
          <h3>Beschreibung</h3>
          <img
            (click)="saveEditedComment()"
            class="edit-channel-mobile"
            [src]="
              editDescription
                ? '/assets/icons/svgs/edit.svg'
                : '/assets/icons/svgs/edit-pencil.svg'
            "
            alt=""
          />
          <h3
            class="edit-channel"
            (click)="saveEditedComment()"
            *ngIf="currentChat !== 'DALobby' && userInChannel"
          >
            @if (editDescription) { Speichern } @else { Bearbeiten }
          </h3>
        </div>
        @if(editDescription) {
        <div class="editDescription">
          <input
            [(ngModel)]="channelDescription"
            type="text"
            placeholder="Dein Text hier"
          />
        </div>
        } @else {
        <p>
          {{ channelDescription }}
        </p>
        }
        <div class="line"></div>
        <h3>Erstellt von:</h3>
        <h3>{{ channelFounder }}</h3>
      </div>
      <div>
        <button
          class="leave-channel-button"
          *ngIf="currentChat !== 'DALobby' && userInChannel"
          click-stop-propagation
          (click)="chatOverlay.overlayFunction(false, 'Entwicklung', false); leaveChannel()"
        >
          Channel verlassen
        </button>
      </div>
      <div class="view-member-wrapper">
        <div class="view-members-mobile">
          <div>
            <h3>Mitglieder</h3>
          </div>
          <div class="no-scrollbar">
            <div
              (click)="chatOverlay.openProfile(user)"
              class="no-scrollbar"
              *ngFor="let user of users; let i = index"
              [class.no-display]="!currentMemberIndices.includes(i)"
            >
              <article>
                <figure *ngIf="user?.uid" class="user-avatar">
                  <img
                    [src]="user?.avatar || 'assets/avatars/profile.png'"
                    [alt]="user?.name || ''"
                  />
                  @if (user?.status) {
                  <img src="../../../../assets/img/online.png" alt="" />
                  } @else {
                  <img src="../../../../assets/img/offline.svg" alt="" />
                  }
                </figure>
                <p>
                  {{ user?.name || "" }} @if(user.uid === getUserId()) { (Du) }
                </p>
              </article>
            </div>
          </div>

          <button
            class="add-member-button"
            (click)="chatOverlay.switchAddMemberOverlay = true"
            *ngIf="currentChat !== 'DALobby' && userInChannel"
          >
            <div>
              <svg
                width="22"
                height="16"
                viewBox="0 0 22 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M18 10C17.7167 10 17.4793 9.904 17.288 9.712C17.096 9.52067 17 9.28333 17 9V7H15C14.7167 7 14.4793 6.904 14.288 6.712C14.096 6.52067 14 6.28333 14 6C14 5.71667 14.096 5.479 14.288 5.287C14.4793 5.09567 14.7167 5 15 5H17V3C17 2.71667 17.096 2.479 17.288 2.287C17.4793 2.09567 17.7167 2 18 2C18.2833 2 18.5207 2.09567 18.712 2.287C18.904 2.479 19 2.71667 19 3V5H21C21.2833 5 21.5207 5.09567 21.712 5.287C21.904 5.479 22 5.71667 22 6C22 6.28333 21.904 6.52067 21.712 6.712C21.5207 6.904 21.2833 7 21 7H19V9C19 9.28333 18.904 9.52067 18.712 9.712C18.5207 9.904 18.2833 10 18 10ZM8 8C6.9 8 5.95833 7.60833 5.175 6.825C4.39167 6.04167 4 5.1 4 4C4 2.9 4.39167 1.95833 5.175 1.175C5.95833 0.391667 6.9 0 8 0C9.1 0 10.0417 0.391667 10.825 1.175C11.6083 1.95833 12 2.9 12 4C12 5.1 11.6083 6.04167 10.825 6.825C10.0417 7.60833 9.1 8 8 8ZM1 16C0.716667 16 0.479333 15.904 0.288 15.712C0.096 15.5207 0 15.2833 0 15V13.2C0 12.6333 0.146 12.1123 0.438 11.637C0.729333 11.1623 1.11667 10.8 1.6 10.55C2.63333 10.0333 3.68333 9.64567 4.75 9.387C5.81667 9.129 6.9 9 8 9C9.1 9 10.1833 9.129 11.25 9.387C12.3167 9.64567 13.3667 10.0333 14.4 10.55C14.8833 10.8 15.2707 11.1623 15.562 11.637C15.854 12.1123 16 12.6333 16 13.2V15C16 15.2833 15.904 15.5207 15.712 15.712C15.5207 15.904 15.2833 16 15 16H1ZM2 14H14V13.2C14 13.0167 13.9543 12.85 13.863 12.7C13.771 12.55 13.65 12.4333 13.5 12.35C12.6 11.9 11.6917 11.5623 10.775 11.337C9.85833 11.1123 8.93333 11 8 11C7.06667 11 6.14167 11.1123 5.225 11.337C4.30833 11.5623 3.4 11.9 2.5 12.35C2.35 12.4333 2.22933 12.55 2.138 12.7C2.046 12.85 2 13.0167 2 13.2V14ZM8 6C8.55 6 9.021 5.804 9.413 5.412C9.80433 5.02067 10 4.55 10 4C10 3.45 9.80433 2.97933 9.413 2.588C9.021 2.196 8.55 2 8 2C7.45 2 6.97933 2.196 6.588 2.588C6.196 2.97933 6 3.45 6 4C6 4.55 6.196 5.02067 6.588 5.412C6.97933 5.804 7.45 6 8 6Z"
                  fill="black"
                />
              </svg>
            </div>
            <h3>Mitglieder hinzufügen</h3>
          </button>
        </div>
      </div>
      <div class="leave-channel-button-mobile">
        <button
          class="leave-channel-butto"
          *ngIf="currentChat !== 'DALobby' && userInChannel"
          click-stop-propagation
          (click)="chatOverlay.overlayFunction(false, 'Entwicklung', false); leaveChannel()"
        >
          Channel verlassen
        </button>
      </div>
    </div>
  </h2>
  <div>
    <output
      class="member-overflow"
      (click)="chatOverlay.overlayActivated = true; chatOverlay.viewMemberOverlay = true"
      [ngClass]="{ 'view-active': chatOverlay.viewMemberOverlay }"
    >
      <div>
        <ng-container *ngFor="let user of users; let i = index">
          <img
            *ngIf="
              currentMemberIndices.includes(i) &&
              currentMemberIndices.indexOf(i) <= 2
            "
            [src]="user.avatar"
            alt="Name{{ i }}"
          />
        </ng-container>
      </div>
      <b>{{
        currentMemberIndices.length > 3 ? "3+" : currentMemberIndices.length
      }}</b>

      <div
        [ngClass]="{
          'no-display': !chatOverlay.viewMemberOverlay,
          'add-member-open': chatOverlay.switchAddMemberOverlay,
          'view-members': !chatOverlay.switchAddMemberOverlay
        }"
      >
        @if(chatOverlay.switchAddMemberOverlay) {
        <div>
          <h3>Leute hinzufügen</h3>
          <div
            click-stop-propagation
            (click)="chatOverlay.overlayFunction(false, 'MitgliederWechseln', false)"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_153677_6137"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_153677_6137)">
                <path
                  d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>
        </div>
        <h3>
          # {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
        </h3>
        <div class="members-list no-scrollbar">
          <div>
            <div
              [ngClass]="{ 'no-display': chatOverlay.inputFocused }"
              *ngFor="let channelUser of selectedChannelUsers; let i = index"
            >
              <img [src]="channelUser.avatar" [alt]="channelUser.name" />
              <p>{{ channelUser.name }}</p>
              <div>
                <svg
                  (click)="deleteMember(i)"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_153677_6137"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="24"
                  >
                    <rect width="24" height="24" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_153677_6137)">
                    <path
                      d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                      fill="black"
                    />
                  </g>
                </svg>
              </div>
            </div>
            <input
              id="member-input"
              [(ngModel)]="inputValue"
              #inputEl
              (focus)="chatOverlay.onFocus()"
              (blur)="chatOverlay.onBlur()"
              (input)="onMemberInputChange($any($event.target).value)"
              type="text"
              placeholder="Name eingeben"
            />
          </div>
        </div>
        <div
          class="member-wrapper no-scrollbar"
          [ngClass]="{ 'no-display': !nameInputValue }"
        >
          <div
            *ngFor="let channelUser of channelUsers; let i = index"
            [id]="'channel-user-' + channelUser.uid"
            [class.no-display]="!foundIndexes.includes(i)"
            (click)="addUserToChannel(i)"
          >
            <article>
              <figure class="user-avatar">
                <img [src]="channelUser.avatar" [alt]="channelUser.name" />
                @if (channelUser.status) {
                <img src="../../../../assets/img/online.png" alt="" />
                } @else {
                <img src="../../../../assets/img/offline.svg" alt="" />
                }
              </figure>
              <p>{{ channelUser.name }}</p>
            </article>
          </div>
        </div>
        <div>
          <button
            [disabled]="selectedChannelUsers.length === 0"
            [class.abled-button]="selectedChannelUsers.length > 0"
            (click)="addMembersToChannel()"
          >
            Hinzufügen
          </button>
        </div>
        } @else {
        <div>
          <h3>Mitglieder</h3>
          <div>
            <svg
              click-stop-propagation
              (click)="chatOverlay.overlayFunction(false, 'Mitglieder', false)"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_153677_6137"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_153677_6137)">
                <path
                  d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>
        </div>
        <div class="no-scrollbar">
          <div
            (click)="chatOverlay.openProfile(user)"
            class="no-scrollbar"
            *ngFor="let user of users; let i = index"
            [class.no-display]="!currentMemberIndices.includes(i)"
          >
            <article>
              <figure *ngIf="user?.uid" class="user-avatar">
                <img
                  [src]="user?.avatar || 'assets/avatars/profile.png'"
                  [alt]="user?.name || ''"
                />
                @if (user?.status) {
                <img src="../../../../assets/img/online.png" alt="" />
                } @else {
                <img src="../../../../assets/img/offline.svg" alt="" />
                }
              </figure>
              <p>
                {{ user?.name || "" }} @if(user.uid === getUserId()) { (Du) }
              </p>
            </article>
          </div>
        </div>

        <button
          class="add-member-button"
          (click)="chatOverlay.switchAddMemberOverlay = true"
          *ngIf="currentChat !== 'DALobby' && userInChannel"
        >
          <div>
            <svg
              width="22"
              height="16"
              viewBox="0 0 22 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M18 10C17.7167 10 17.4793 9.904 17.288 9.712C17.096 9.52067 17 9.28333 17 9V7H15C14.7167 7 14.4793 6.904 14.288 6.712C14.096 6.52067 14 6.28333 14 6C14 5.71667 14.096 5.479 14.288 5.287C14.4793 5.09567 14.7167 5 15 5H17V3C17 2.71667 17.096 2.479 17.288 2.287C17.4793 2.09567 17.7167 2 18 2C18.2833 2 18.5207 2.09567 18.712 2.287C18.904 2.479 19 2.71667 19 3V5H21C21.2833 5 21.5207 5.09567 21.712 5.287C21.904 5.479 22 5.71667 22 6C22 6.28333 21.904 6.52067 21.712 6.712C21.5207 6.904 21.2833 7 21 7H19V9C19 9.28333 18.904 9.52067 18.712 9.712C18.5207 9.904 18.2833 10 18 10ZM8 8C6.9 8 5.95833 7.60833 5.175 6.825C4.39167 6.04167 4 5.1 4 4C4 2.9 4.39167 1.95833 5.175 1.175C5.95833 0.391667 6.9 0 8 0C9.1 0 10.0417 0.391667 10.825 1.175C11.6083 1.95833 12 2.9 12 4C12 5.1 11.6083 6.04167 10.825 6.825C10.0417 7.60833 9.1 8 8 8ZM1 16C0.716667 16 0.479333 15.904 0.288 15.712C0.096 15.5207 0 15.2833 0 15V13.2C0 12.6333 0.146 12.1123 0.438 11.637C0.729333 11.1623 1.11667 10.8 1.6 10.55C2.63333 10.0333 3.68333 9.64567 4.75 9.387C5.81667 9.129 6.9 9 8 9C9.1 9 10.1833 9.129 11.25 9.387C12.3167 9.64567 13.3667 10.0333 14.4 10.55C14.8833 10.8 15.2707 11.1623 15.562 11.637C15.854 12.1123 16 12.6333 16 13.2V15C16 15.2833 15.904 15.5207 15.712 15.712C15.5207 15.904 15.2833 16 15 16H1ZM2 14H14V13.2C14 13.0167 13.9543 12.85 13.863 12.7C13.771 12.55 13.65 12.4333 13.5 12.35C12.6 11.9 11.6917 11.5623 10.775 11.337C9.85833 11.1123 8.93333 11 8 11C7.06667 11 6.14167 11.1123 5.225 11.337C4.30833 11.5623 3.4 11.9 2.5 12.35C2.35 12.4333 2.22933 12.55 2.138 12.7C2.046 12.85 2 13.0167 2 13.2V14ZM8 6C8.55 6 9.021 5.804 9.413 5.412C9.80433 5.02067 10 4.55 10 4C10 3.45 9.80433 2.97933 9.413 2.588C9.021 2.196 8.55 2 8 2C7.45 2 6.97933 2.196 6.588 2.588C6.196 2.97933 6 3.45 6 4C6 4.55 6.196 5.02067 6.588 5.412C6.97933 5.804 7.45 6 8 6Z"
                fill="black"
              />
            </svg>
          </div>
          <h3>Mitglieder hinzufügen</h3>
        </button>
        }
      </div>
    </output>

    <div
      (click)="chatOverlay.overlayActivated = true; chatOverlay.addMemberOverlay = true; chatOverlay.viewMemberMedia()"
      *ngIf="currentChat && currentChat !== 'DALobby' && userInChannel"
    >
      <svg
        width="22"
        height="16"
        viewBox="0 0 22 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M18 10C17.7167 10 17.4793 9.904 17.288 9.712C17.096 9.52067 17 9.28333 17 9V7H15C14.7167 7 14.4793 6.904 14.288 6.712C14.096 6.52067 14 6.28333 14 6C14 5.71667 14.096 5.479 14.288 5.287C14.4793 5.09567 14.7167 5 15 5H17V3C17 2.71667 17.096 2.479 17.288 2.287C17.4793 2.09567 17.7167 2 18 2C18.2833 2 18.5207 2.09567 18.712 2.287C18.904 2.479 19 2.71667 19 3V5H21C21.2833 5 21.5207 5.09567 21.712 5.287C21.904 5.479 22 5.71667 22 6C22 6.28333 21.904 6.52067 21.712 6.712C21.5207 6.904 21.2833 7 21 7H19V9C19 9.28333 18.904 9.52067 18.712 9.712C18.5207 9.904 18.2833 10 18 10ZM8 8C6.9 8 5.95833 7.60833 5.175 6.825C4.39167 6.04167 4 5.1 4 4C4 2.9 4.39167 1.95833 5.175 1.175C5.95833 0.391667 6.9 0 8 0C9.1 0 10.0417 0.391667 10.825 1.175C11.6083 1.95833 12 2.9 12 4C12 5.1 11.6083 6.04167 10.825 6.825C10.0417 7.60833 9.1 8 8 8ZM1 16C0.716667 16 0.479333 15.904 0.288 15.712C0.096 15.5207 0 15.2833 0 15V13.2C0 12.6333 0.146 12.1123 0.438 11.637C0.729333 11.1623 1.11667 10.8 1.6 10.55C2.63333 10.0333 3.68333 9.64567 4.75 9.387C5.81667 9.129 6.9 9 8 9C9.1 9 10.1833 9.129 11.25 9.387C12.3167 9.64567 13.3667 10.0333 14.4 10.55C14.8833 10.8 15.2707 11.1623 15.562 11.637C15.854 12.1123 16 12.6333 16 13.2V15C16 15.2833 15.904 15.5207 15.712 15.712C15.5207 15.904 15.2833 16 15 16H1ZM2 14H14V13.2C14 13.0167 13.9543 12.85 13.863 12.7C13.771 12.55 13.65 12.4333 13.5 12.35C12.6 11.9 11.6917 11.5623 10.775 11.337C9.85833 11.1123 8.93333 11 8 11C7.06667 11 6.14167 11.1123 5.225 11.337C4.30833 11.5623 3.4 11.9 2.5 12.35C2.35 12.4333 2.22933 12.55 2.138 12.7C2.046 12.85 2 13.0167 2 13.2V14ZM8 6C8.55 6 9.021 5.804 9.413 5.412C9.80433 5.02067 10 4.55 10 4C10 3.45 9.80433 2.97933 9.413 2.588C9.021 2.196 8.55 2 8 2C7.45 2 6.97933 2.196 6.588 2.588C6.196 2.97933 6 3.45 6 4C6 4.55 6.196 5.02067 6.588 5.412C6.97933 5.804 7.45 6 8 6Z"
          fill="black"
        />
      </svg>
      <div class="add-member" [ngClass]="{ 'no-display': !chatOverlay.addMemberOverlay }">
        <div>
          <h3>Leute hinzufügen</h3>
          <div
            click-stop-propagation
            (click)="chatOverlay.overlayFunction(false, 'Hinzufügen', false)"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_153677_6137"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_153677_6137)">
                <path
                  d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>
        </div>
        <h3>
          # {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
        </h3>
        <div class="members-list no-scrollbar">
          <div>
            <div
              [ngClass]="{ 'no-display': chatOverlay.inputFocused }"
              *ngFor="let channelUser of selectedChannelUsers; let i = index"
            >
              <img [src]="channelUser.avatar" [alt]="channelUser.name" />
              <p>{{ channelUser.name }}</p>
              <div>
                <svg
                  (click)="deleteMember(i)"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_153677_6137"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="24"
                  >
                    <rect width="24" height="24" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_153677_6137)">
                    <path
                      d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                      fill="black"
                    />
                  </g>
                </svg>
              </div>
            </div>
            <input
              id="member-input"
              [(ngModel)]="inputValue"
              #inputEl
              (focus)="chatOverlay.onFocus()"
              (blur)="chatOverlay.onBlur()"
              (input)="onMemberInputChange($any($event.target).value)"
              type="text"
              placeholder="Name eingeben"
            />
          </div>
        </div>
        <div
          class="member-wrapper no-scrollbar"
          [ngClass]="{ 'no-display': !nameInputValue }"
        >
          <div
            *ngFor="let channelUser of channelUsers; let i = index"
            [id]="'channel-user-' + channelUser.uid"
            [class.no-display]="!foundIndexes.includes(i)"
            (click)="addUserToChannel(i)"
          >
            <article>
              <figure class="user-avatar">
                <img [src]="channelUser.avatar" [alt]="channelUser.name" />
                @if (channelUser.status) {
                <img src="../../../../assets/img/online.png" alt="" />
                } @else {
                <img src="../../../../assets/img/offline.svg" alt="" />
                }
              </figure>
              <p>{{ channelUser.name }}</p>
            </article>
          </div>
        </div>
        <div>
          <button
            [disabled]="selectedChannelUsers.length === 0"
            [class.abled-button]="selectedChannelUsers.length > 0"
            (click)="addMembersToChannel()"
          >
            Hinzufügen
          </button>
        </div>
      </div>
      <div
        [ngClass]="{
          'no-display': !chatOverlay.viewMemberOverlay,
          'add-member-open': chatOverlay.switchAddMemberOverlay,
          'view-member-mobile-overlay': !chatOverlay.switchAddMemberOverlay,

        }"
      >
        @if(chatOverlay.switchAddMemberOverlay) {
        <div>
          <h3>Leute hinzufügen</h3>
          <div
            click-stop-propagation
            (click)="chatOverlay.overlayFunction(false, 'MitgliederWechseln', false)"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_153677_6137"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_153677_6137)">
                <path
                  d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>
        </div>
        <h3>
          # {{ currentChat.charAt(0).toUpperCase() + currentChat.slice(1) }}
        </h3>
        <div class="members-list no-scrollbar">
          <div>
            <div
              [ngClass]="{ 'no-display': chatOverlay.inputFocused }"
              *ngFor="let channelUser of selectedChannelUsers; let i = index"
            >
              <img [src]="channelUser.avatar" [alt]="channelUser.name" />
              <p>{{ channelUser.name }}</p>
              <div>
                <svg
                  (click)="deleteMember(i)"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_153677_6137"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="24"
                  >
                    <rect width="24" height="24" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_153677_6137)">
                    <path
                      d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                      fill="black"
                    />
                  </g>
                </svg>
              </div>
            </div>
            <input
              id="member-input"
              [(ngModel)]="inputValue"
              #inputEl
              (focus)="chatOverlay.onFocus()"
              (blur)="chatOverlay.onBlur()"
              (input)="onMemberInputChange($any($event.target).value)"
              type="text"
              placeholder="Name eingeben"
            />
          </div>
        </div>
        <div
          class="member-wrapper no-scrollbar"
          [ngClass]="{ 'no-display': !nameInputValue }"
        >
          <div
            *ngFor="let channelUser of channelUsers; let i = index"
            [id]="'channel-user-' + channelUser.uid"
            [class.no-display]="!foundIndexes.includes(i)"
            (click)="addUserToChannel(i)"
          >
            <article>
              <figure class="user-avatar">
                <img [src]="channelUser.avatar" [alt]="channelUser.name" />
                @if (channelUser.status) {
                <img src="../../../../assets/img/online.png" alt="" />
                } @else {
                <img src="../../../../assets/img/offline.svg" alt="" />
                }
              </figure>
              <p>{{ channelUser.name }}</p>
            </article>
          </div>
        </div>
        <div>
          <button
            [disabled]="selectedChannelUsers.length === 0"
            [class.abled-button]="selectedChannelUsers.length > 0"
            (click)="addMembersToChannel()"
          >
            Hinzufügen
          </button>
        </div>
        } @else {
        <div>
          <h3>Mitglieder</h3>
          <div>
            <svg
              click-stop-propagation
              (click)="chatOverlay.overlayFunction(false, 'Mitglieder', false)"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_153677_6137"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_153677_6137)">
                <path
                  d="M12 13.4L7.09999 18.3C6.91665 18.4833 6.68332 18.575 6.39999 18.575C6.11665 18.575 5.88332 18.4833 5.69999 18.3C5.51665 18.1167 5.42499 17.8833 5.42499 17.6C5.42499 17.3167 5.51665 17.0833 5.69999 16.9L10.6 12L5.69999 7.09999C5.51665 6.91665 5.42499 6.68332 5.42499 6.39999C5.42499 6.11665 5.51665 5.88332 5.69999 5.69999C5.88332 5.51665 6.11665 5.42499 6.39999 5.42499C6.68332 5.42499 6.91665 5.51665 7.09999 5.69999L12 10.6L16.9 5.69999C17.0833 5.51665 17.3167 5.42499 17.6 5.42499C17.8833 5.42499 18.1167 5.51665 18.3 5.69999C18.4833 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4833 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4833 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4833 18.1167 18.3 18.3C18.1167 18.4833 17.8833 18.575 17.6 18.575C17.3167 18.575 17.0833 18.4833 16.9 18.3L12 13.4Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>
        </div>
        <div class="no-scrollbar">
          <div
            (click)="chatOverlay.openProfile(user)"
            class="no-scrollbar"
            *ngFor="let user of users; let i = index"
            [class.no-display]="!currentMemberIndices.includes(i)"
          >
            <article>
              <figure *ngIf="user?.uid" class="user-avatar">
                <img
                  [src]="user?.avatar || 'assets/avatars/profile.png'"
                  [alt]="user?.name || ''"
                />
                @if (user?.status) {
                <img src="../../../../assets/img/online.png" alt="" />
                } @else {
                <img src="../../../../assets/img/offline.svg" alt="" />
                }
              </figure>
              <p>
                {{ user?.name || "" }} @if(user.uid === getUserId()) { (Du) }
              </p>
            </article>
          </div>
        </div>

        <button
          class="add-member-button"
          (click)="chatOverlay.switchAddMemberOverlay = true"
          *ngIf="currentChat !== 'DALobby' && userInChannel"
        >
          <div>
            <svg
              width="22"
              height="16"
              viewBox="0 0 22 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M18 10C17.7167 10 17.4793 9.904 17.288 9.712C17.096 9.52067 17 9.28333 17 9V7H15C14.7167 7 14.4793 6.904 14.288 6.712C14.096 6.52067 14 6.28333 14 6C14 5.71667 14.096 5.479 14.288 5.287C14.4793 5.09567 14.7167 5 15 5H17V3C17 2.71667 17.096 2.479 17.288 2.287C17.4793 2.09567 17.7167 2 18 2C18.2833 2 18.5207 2.09567 18.712 2.287C18.904 2.479 19 2.71667 19 3V5H21C21.2833 5 21.5207 5.09567 21.712 5.287C21.904 5.479 22 5.71667 22 6C22 6.28333 21.904 6.52067 21.712 6.712C21.5207 6.904 21.2833 7 21 7H19V9C19 9.28333 18.904 9.52067 18.712 9.712C18.5207 9.904 18.2833 10 18 10ZM8 8C6.9 8 5.95833 7.60833 5.175 6.825C4.39167 6.04167 4 5.1 4 4C4 2.9 4.39167 1.95833 5.175 1.175C5.95833 0.391667 6.9 0 8 0C9.1 0 10.0417 0.391667 10.825 1.175C11.6083 1.95833 12 2.9 12 4C12 5.1 11.6083 6.04167 10.825 6.825C10.0417 7.60833 9.1 8 8 8ZM1 16C0.716667 16 0.479333 15.904 0.288 15.712C0.096 15.5207 0 15.2833 0 15V13.2C0 12.6333 0.146 12.1123 0.438 11.637C0.729333 11.1623 1.11667 10.8 1.6 10.55C2.63333 10.0333 3.68333 9.64567 4.75 9.387C5.81667 9.129 6.9 9 8 9C9.1 9 10.1833 9.129 11.25 9.387C12.3167 9.64567 13.3667 10.0333 14.4 10.55C14.8833 10.8 15.2707 11.1623 15.562 11.637C15.854 12.1123 16 12.6333 16 13.2V15C16 15.2833 15.904 15.5207 15.712 15.712C15.5207 15.904 15.2833 16 15 16H1ZM2 14H14V13.2C14 13.0167 13.9543 12.85 13.863 12.7C13.771 12.55 13.65 12.4333 13.5 12.35C12.6 11.9 11.6917 11.5623 10.775 11.337C9.85833 11.1123 8.93333 11 8 11C7.06667 11 6.14167 11.1123 5.225 11.337C4.30833 11.5623 3.4 11.9 2.5 12.35C2.35 12.4333 2.22933 12.55 2.138 12.7C2.046 12.85 2 13.0167 2 13.2V14ZM8 6C8.55 6 9.021 5.804 9.413 5.412C9.80433 5.02067 10 4.55 10 4C10 3.45 9.80433 2.97933 9.413 2.588C9.021 2.196 8.55 2 8 2C7.45 2 6.97933 2.196 6.588 2.588C6.196 2.97933 6 3.45 6 4C6 4.55 6.196 5.02067 6.588 5.412C6.97933 5.804 7.45 6 8 6Z"
                fill="black"
              />
            </svg>
          </div>
          <h3>Mitglieder hinzufügen</h3>
        </button>
        }
      </div>
    </div>
  </div>
</header>

<output chat-scroll [messages]="chatController.messages">
  <div *ngIf="chatController.messages.length > 0">
    <div
      *ngFor="let msg of chatController.messages; let i = index"
      class="message"
      [ngClass]="{
        'own-message': msg.uid === getUserId(),
        'edit-message': chatController.editMessageIsOpen && chatController.editingMessageId === msg.id,
        'not-edit-message': !chatController.editMessageIsOpen
      }"
      (mouseover)="chatController.hoverMessage(msg.id, msg.uid, $event)"
      (mouseleave)="chatController.leaveMessage(msg.id); chatController.editMessageMenuOpen = null"
    >
      @if (msg.system === true) {
      <div class="system">
        <p>{{ msg.user }}</p>
      </div>
      } @else {
      <div
        class="message-event"
        *ngIf="
          i === 0 ||
          (msg.timestamp | date : 'yyyy-MM-dd') !==
            (chatController.messages[i - 1].timestamp | date : 'yyyy-MM-dd')
        "
      >
        <div></div>
        <span class="timestamp">
          {{
            (msg.timestamp | date : "yyyy-MM-dd") ===
            (today | date : "yyyy-MM-dd")
              ? "Heute"
              : (msg.timestamp | date : "EEEE, d MMMM")
          }}
        </span>
        <div></div>
      </div>

      <div
        class="message-container"
        [ngClass]="{ 'edit-mode-width': chatController.editMessageIsOpen && chatController.editingMessageId === msg.id }"
      >
        <img src="{{ getProfilePic(msg.uid) }}" alt="{{ msg.user }}" />
        <div [ngClass]="{ 'edit-mode-width': chatController.editMessageIsOpen && chatController.editingMessageId === msg.id }">
          <div>
            <strong>{{ msg.user }}</strong>
            <span
              class="timestamp"
              [ngClass]="{
                'no-display': chatController.editMessageIsOpen && chatController.editingMessageId === msg.id
              }"
              >{{ msg.timestamp | date : "HH:mm" }} Uhr</span
            >
          </div>

          @if (chatController.editingMessageId === msg.id) {
          <!-- Edit Mode -->
          <div
            class="message-edit-bubble"
            [ngClass]="{
              'edit-mode-bubble':
                chatController.editMessageIsOpen && chatController.editingMessageId === msg.id,
              'edit-mode-width':
                chatController.editMessageIsOpen && chatController.editingMessageId === msg.id
            }"
          >
            <textarea
              [(ngModel)]="chatController.editingMessageText"
              rows="3"
              class="message-edit-textarea"

            ></textarea>
            <div class="message-edit-actions">
              <div class="button-group">
                <button
                  type="button"
                  (click)="chatController.cancelEdit()"
                  class="btn-secondary"
                >
                  Abbrechen
                </button>
                <button
                  type="button"
                  (click)="chatController.saveEditedMessage(msg.id)"
                  class="btn-primary"
                >
                  Speichern
                </button>
              </div>
            </div>
          </div>
          } @else {
          <div
            id="message-text-{{ msg.id }}"
            class="message-text"
            [innerHTML]="msg.text | linkify:users:channels"
            [attr.data-message-id]="msg.id"
          >
          </div>
          <app-reactions
            [reactions]="msg.reactions || {}"
            [currentUserId]="getUserId()"
            [users]="users"
            [compact]="false"
            [addEmoji]="chatController.addEmojiToMessage[msg.id] || undefined"
            [isOwnMessage]="msg.uid === getUserId()"
            [notOwnMessage]="msg.uid !== getUserId()"
            [externalPickerOpen]="chatController.showReactionPicker[msg.id] || false"
            [(externalPickerOpen)]="chatController.showReactionPicker[msg.id]"
            (toggled)="chatController.onReactionToggle(msg, $event)"
            (addedNew)="chatController.onReactionAdd(msg, $event)"
            [class.is-empty]="
              !(msg.reactions && Object.keys(msg.reactions).length > 0)
            "
          >
          </app-reactions>

          <div class="message-answer">
            @if (msg.threaded) {
            <span
              (click)="
                openThread(msg.id, {
                  uid: msg.uid,
                  text: msg.text,
                  user: msg.user,
                  timestamp: msg.timestamp
                })
              "
            >
              @if (msg.threaded.amount == 1) {
              {{ msg.threaded.amount }} Antwort } @else {
              {{ msg.threaded.amount }} Antworten }
            </span>
            <span>Letzte Antwort {{ msg.threaded.last | date : "HH:mm" }}</span>
            }
          </div>
          }
        </div>
      </div>
      }
      <div
        class="message-actions-container"
        [ngClass]="{
          'no-message-event':
            i !== 0 &&
            (msg.timestamp | date : 'yyyy-MM-dd') ===
              (chatController.messages[i - 1].timestamp | date : 'yyyy-MM-dd')
        }"
      >
        <div
          class="comment-hover-overlay"
          [id]="'comment-hover-' + msg.id"
          [ngClass]="{
            'no-display': chatController.editMessageIsOpen && chatController.editingMessageId === msg.id
          }"
        >
          <div (click)="chatController.addEmojiToMessageField('✓', msg.id)">
            <img src="./assets/img/checkMark.svg" alt="Reaktion hinzufügen" />
          </div>
          <div (click)="chatController.addEmojiToMessageField('👍', msg.id)">
            <img src="./assets/img/capa.svg" alt="Daumen hoch" />
          </div>
          <div (click)="chatController.openReactionPicker(msg.id)">
            <img src="./assets/icons/reactions/addReaction.png" alt="" />
          </div>
          <div
            (click)="
              openThread(msg.id, {
                uid: msg.uid,
                text: msg.text,
                user: msg.user,
                timestamp: msg.timestamp
              })
            "
          ><img src="./assets/icons/svgs/comment.svg" alt="" /></div>
          <div
            [ngClass]="{ 'no-display': msg.uid !== getUserId() }"
            class="more-vert-button"
            (click)="chatController.toggleEditMessageMenu(msg.id, $event)"
          >
            <img src="./assets/icons/svgs/moreVert.svg" alt="" />
          </div>
        </div>
        <div
          class="edit-message-menu"
          [class.visible]="chatController.editMessageMenuOpen === msg.id"
        >
          <div (click)="chatController.editMessage(msg.id)">Nachricht bearbeiten</div>
        </div>
      </div>
    </div>
  </div>
</output>

<form
  aria-label="Nachricht senden"
  (submit)="chatController.sendMessage(users); $event.preventDefault()"
>
  <label for="message"></label>
  <div id="search-chat-channels" class="text-channel-list no-display">
    <ng-container *ngFor="let channel of chatController.filteredChannels">
      <div
        (click)="chatController.insertMention(channel.name, messageInput)"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_157289_4664"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="24"
            height="24"
          >
            <rect width="24" height="24" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_157289_4664)">
            <path
              d="M7.22504 20.325C6.7917 20.325 6.45004 20.1623 6.20004 19.837C5.95004 19.5123 5.87504 19.1417 5.97504 18.725L6.57504 16.325H4.77504C4.34171 16.325 3.9917 16.1583 3.72504 15.825C3.45837 15.4917 3.38337 15.1083 3.50004 14.675C3.58337 14.3917 3.7417 14.154 3.97504 13.962C4.20837 13.7707 4.47504 13.675 4.77504 13.675H7.25004L8.07504 10.325H5.77504C5.3417 10.325 4.9917 10.1583 4.72504 9.82499C4.45837 9.49165 4.38337 9.10832 4.50004 8.67499C4.58337 8.39165 4.7417 8.15432 4.97504 7.96299C5.20837 7.77099 5.47504 7.67499 5.77504 7.67499H8.75004L9.50004 4.64999C9.58337 4.36665 9.74171 4.13332 9.97504 3.94999C10.2084 3.76665 10.475 3.67499 10.775 3.67499C11.2084 3.67499 11.55 3.83732 11.8 4.16199C12.05 4.48732 12.125 4.85832 12.025 5.27499L11.425 7.67499H14.75L15.5 4.64999C15.5834 4.36665 15.7417 4.13332 15.975 3.94999C16.2084 3.76665 16.475 3.67499 16.775 3.67499C17.2084 3.67499 17.55 3.83732 17.8 4.16199C18.05 4.48732 18.125 4.85832 18.025 5.27499L17.425 7.67499H19.225C19.6584 7.67499 20.0084 7.84165 20.275 8.17499C20.5417 8.50832 20.6167 8.89165 20.5 9.32499C20.4167 9.60832 20.2584 9.84565 20.025 10.037C19.7917 10.229 19.525 10.325 19.225 10.325H16.75L15.925 13.675H18.225C18.6584 13.675 19.0084 13.8417 19.275 14.175C19.5417 14.5083 19.6167 14.8917 19.5 15.325C19.4167 15.6083 19.2584 15.846 19.025 16.038C18.7917 16.2293 18.525 16.325 18.225 16.325H15.25L14.5 19.35C14.4167 19.6333 14.2584 19.8667 14.025 20.05C13.7917 20.2333 13.525 20.325 13.225 20.325C12.7917 20.325 12.45 20.1623 12.2 19.837C11.95 19.5123 11.875 19.1417 11.975 18.725L12.575 16.325H9.25004L8.50004 19.35C8.4167 19.6333 8.25837 19.8667 8.02504 20.05C7.7917 20.2333 7.52504 20.325 7.22504 20.325ZM9.92504 13.675H13.25L14.075 10.325H10.75L9.92504 13.675Z"
              fill="black"
            />
          </g>
        </svg>

        <h3>
          {{ channel.name.charAt(0).toUpperCase() + channel.name.slice(1) }}
        </h3>
      </div>
    </ng-container>
  </div>
  <div id="search-chat-members" class="text-member-list no-display">
    <ng-container *ngFor="let user of chatController.filteredUsers">
      <div
        *ngIf="user.name"
        (click)="chatController.insertMention(user.name, messageInput)"
      >
        <article>
          <figure class="user-avatar">
            <img [src]="user.avatar" [alt]="user.name" />

            @if (user.status) {
              <img src="../../../../assets/img/online.png" alt="" />
            } @else {
              <img src="../../../../assets/img/offline.svg" alt="" />
            }
          </figure>

          <p>{{ user.name }}</p>
        </article>
      </div>
    </ng-container>
  </div>
  <textarea
    #messageInput
    id="message"
    (input)="onInputChange($any($event.target).value)"
    name="message"
    placeholder="Nachricht an #{{
      currentChat.charAt(0).toUpperCase() + currentChat.slice(1)
    }}"
    rows="2"
    (keydown.enter)="$event.preventDefault(); chatController.sendMessage(users)"
    [(ngModel)]="chatController.messageText"
  ></textarea>
  <button
    type="button"
    class="emoji-insert"
    (click)="chatController.showPicker = !chatController.showPicker"
    aria-label="Emoji einfügen"
  >
    😊
  </button>

  <div class="picker" *ngIf="chatController.showPicker" (mouseleave)="chatController.showPicker = false">
    <button
      *ngFor="
        let e of ['😀', '👍', '🎉', '❤️', '😊', '🙏', '🚀', '🤔', '😅', '🔥', '✅']
      "
      type="button"
      (click)="chatController.insertEmojiIntoText(e); chatController.showPicker = false"
    >
      {{ e }}
    </button>
  </div>
  <button type="submit" aria-label="Nachricht senden">
    <svg
      width="23"
      height="20"
      viewBox="0 0 23 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M2.5 19.2812C2.08333 19.4479 1.6875 19.4112 1.3125 19.1712C0.9375 18.9321 0.75 18.5833 0.75 18.125V13.4687C0.75 13.1771 0.833333 12.9167 1 12.6875C1.16667 12.4583 1.39583 12.3125 1.6875 12.25L10.75 9.99999L1.6875 7.74999C1.39583 7.68749 1.16667 7.54166 1 7.31249C0.833333 7.08333 0.75 6.82291 0.75 6.53124V1.87499C0.75 1.41666 0.9375 1.06749 1.3125 0.827493C1.6875 0.588327 2.08333 0.552076 2.5 0.718743L21.75 8.84374C22.2708 9.07291 22.5312 9.45833 22.5312 9.99999C22.5312 10.5417 22.2708 10.9271 21.75 11.1562L2.5 19.2812Z"
        fill="#444DF2"
      />
    </svg>
  </button>
</form>
